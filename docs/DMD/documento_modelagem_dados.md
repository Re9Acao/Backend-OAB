# üìò Documento de Modelagem de Dados (DMD)

## üßæ Informa√ß√µes Gerais

- **Projeto**: Sistema de Simulados OAB
- **Autor**: Ana Karina Caetano e Sarah Bethelim
- **Data de Cria√ß√£o**: 12/03/2025
- **√öltima Atualiza√ß√£o**: 25/05/2025
- **Ferramenta utilizada:**: [dbdiagram.io (DBML)](https://dbml.dbdiagram.io/home)
- **Tecnologias utilizadas**: Ruby on Rails 7.1.2 + PostgreSQL

---

## üß† Vis√£o Geral

O sistema de simulados tem como objetivo oferecer quest√µes da OAB para treinamento dos alunos, com suporte para quest√µes objetivas e discursivas. O banco de dados armazena informa√ß√µes sobre os simulados, usu√°rios, quest√µes, respostas e estat√≠sticas dos usu√°rios.

---

## üî∂ Diagrama Entidade-Relacionamento (ER)

![diagrama entidade-relacionamento](DER-OAB.svg)


---

## üóÇÔ∏è Dicion√°rio de Dados


### üìå Entidade: `User`

Representa os usu√°rios da plataforma, com dados de autentica√ß√£o, controle de acesso e informa√ß√µes para gerenciamento de sess√£o.

| Campo                 | Tipo      | Chave | Not Null | Descri√ß√£o                                                          |
|-----------------------|-----------|-------|----------|--------------------------------------------------------------------|
| id                    | bigint    | PK    | ‚úî        | Identificador √∫nico                                                |
| email                 | string    |       | ‚úî        | E-mail do usu√°rio                                                  |
| encrypted_password    | string    |       | ‚úî        | Senha criptografada                                                |
| reset_password_token  | string    |       |          | Token para redefini√ß√£o de senha                                    |
| reset_password_sent_at| datetime  |       |          | Data do envio do token                                             |
| remember_created_at   | datetime  |       |          | Data de cria√ß√£o do cookie de sess√£o                                |
| sign_in_count         | integer   |       | ‚úî        | Contagem de acessos                                                |
| current_sign_in_at    | datetime  |       |          | Data do √∫ltimo acesso atual                                        |
| last_sign_in_at       | datetime  |       |          | Data do pen√∫ltimo acesso                                           |
| current_sign_in_ip    | string    |       |          | IP do √∫ltimo acesso atual                                          |
| last_sign_in_ip       | string    |       |          | IP do pen√∫ltimo acesso                                             |
| created_at            | datetime  |       | ‚úî        | Data de cria√ß√£o                                                   |
| updated_at            | datetime  |       | ‚úî        | Data de atualiza√ß√£o                                               |
| provider              | string    |       |          | Provedor de autentica√ß√£o                                          |
| uid                   | string    |       |          | UID do provedor                                                  |
| allow_password_change | boolean   |       |          | Permite redefinir senha sem token                                 |
| tokens                | json      |       |          | Tokens de autentica√ß√£o                                           |
| role                  | integer   |       | ‚úî        | Perfil do usu√°rio: 0 = basic, 1 = premium, 2 = admin             |

#### üîó Relacionamentos

- Um `User` pode ter v√°rias `Evaluations` realizadas.
- Um `User` pode ter v√°rias `UserAnswers` (respostas dadas).


### üìå Entidade: `LawArea`

Representa uma √°rea do Direito (como Direito Penal, Civil, Constitucional, etc.).
| Campo       | Tipo      | Chave | Not Null | Descri√ß√£o                   |
|-------------|-----------|-------|----------|-----------------------------|
| id          | bigint    | PK    | ‚úî        | Identificador √∫nico         |
| name        | string    |       | ‚úî        | Nome da √°rea                |
| description | string    |       |          | Descri√ß√£o da √°rea           |
| created_at  | datetime  |       | ‚úî        | Data de cria√ß√£o             |
| updated_at  | datetime  |       | ‚úî        | Data de atualiza√ß√£o         |

#### üîó Relacionamentos

- Uma `LawArea` pode ter v√°rias `questions` associadas.
- Uma `LawArea` pode estar associada a v√°rias `Evaluations` via `EvaluationLawArea`.
- Uma `LawArea` pode estar associada a v√°rios `UserPerformances`.



### üìå Entidade: `Question`

Representa uma quest√£o do simulado, com op√ß√µes de respostas, correta, √°rea do direito relacionada e informa√ß√µes da prova.

| Campo            | Tipo      | Chave | Not Null | Descri√ß√£o                      |
|------------------|-----------|-------|----------|-------------------------------|
| id               | bigint    | PK    | ‚úî        | Identificador √∫nico            |
| title            | string    |       | ‚úî        | T√≠tulo da quest√£o             |
| evaluation_board | string    |       |          | Banca avaliadora              |
| year             | string    |       |          | Ano da quest√£o               |
| option_1         | string    |       | ‚úî        | Op√ß√£o de resposta 1          |
| option_2         | string    |       | ‚úî        | Op√ß√£o de resposta 2          |
| option_3         | string    |       | ‚úî        | Op√ß√£o de resposta 3          |
| option_4         | string    |       | ‚úî        | Op√ß√£o de resposta 4          |
| option_5         | string    |       |          | Op√ß√£o de resposta 5 (opcional)|
| correct_option   | integer   |       | ‚úî        |√çndice da resposta correta (1 a 5) ‚Äî apenas para quest√µes objetivas   #type == 1          |
| available        | boolean   |       |        | Indica se a quest√£o est√° dispon√≠vel|
| law_area_id      | bigint    | FK    | ‚úî        | Refer√™ncia √† √Årea de direito|
| created_at       | datetime  |       | ‚úî        | Data de cria√ß√£o              |
| updated_at       | datetime  |       | ‚úî        | Data de atualiza√ß√£o          |
| question_type    | smallint  |       | ‚úî        | Tipo da quest√£o (enum: 1=objetiva, 2=discursiva, 3=dissertativa)       |

#### üîó Relacionamentos

- Uma `Question` pertence a uma `LawArea`.
- Uma `Question` pertence a um `questiton_type` (tipo da quest√£o, via campo `questiton_type`).
- Uma `Question` tem uma `StandardAnswer` (somente se discursiva ou dissertativa)
- Uma `Question` pode ter v√°rias `UserAnswers` (respostas dadas pelos usu√°rios).
- Uma `Question` pode estar em v√°rias `Evaluations` via EvaluationQuestion.
- Uma `Question` pode ter muitas `UserAnswers`, cada uma associada a um usu√°rio diferente e avalia√ß√£o diferente.



### üìå Entidade: `Evaluation`

Representa uma tentativa de simulado feita por um usu√°rio. Cada `Evaluation` pertence a um usu√°rio e armazena a pontua√ß√£o e status do simulado.

| Campo       | Tipo      | Chave | Not Null | Descri√ß√£o                             |
|-------------|-----------|-------|----------|---------------------------------------|
| id          | bigint    | PK    | ‚úî        | Identificador √∫nico                   |
| expires_at  | datetime  |       |          | Data de expira√ß√£o do simulado         |
| finished    | boolean   |       | ‚úî        | Indica se o simulado foi finalizado   |
| user_id     | bigint    | FK    | ‚úî        | Refer√™ncia ao usu√°rio                 |
| correct_score | integer   |       |        | Pontua√ß√£o final obtida                |
| created_at  | datetime  |       | ‚úî        | Data de cria√ß√£o                       |
| updated_at  | datetime  |       | ‚úî        | Data de atualiza√ß√£o                   |

#### üîó Relacionamentos

- Uma `Evaluation` pertence a um `User`.
- Uma `Evaluation` pode ter v√°rias `Questions` (quest√µes que comp√µem o simulado).
- Uma `Evaluation` pode ter v√°rias `UserAnswers` (quest√µes respondidas).
- Uma `Evaluation` pode estar associada a v√°rias `LawAreas` via `EvaluationLawArea`.



### üìå Entidade: `EvaluationLawArea`

Associa√ß√£o entre simulados (`Evaluation`) e √°reas do direito (`LawArea`). Usada para organizar e filtrar quest√µes conforme a √°rea jur√≠dica.

| Campo         | Tipo     | Chave | Not Null | Descri√ß√£o                            |
|---------------|----------|-------|----------|----------------------------------------|
| id            | bigint   | PK    | ‚úî        | Identificador √∫nico                    |
| evaluation_id | bigint   | FK    | ‚úî        | Refer√™ncia ao simulado                 |
| law_area_id   | bigint   | FK    | ‚úî        | Refer√™ncia √† √°rea do direito           |
| created_at    | datetime |       | ‚úî        | Data de cria√ß√£o                        |
| updated_at    | datetime |       | ‚úî        | Data de atualiza√ß√£o                    |

#### üîó Relacionamentos

- Uma `EvaluationLawArea` pertence a uma `Evaluation`.
- Uma `EvaluationLawArea` pertence a uma `LawArea`.


### üìå Entidade: `EvaluationQuestion`

Associa uma quest√£o (`Question`) a um simulado (`Evaluation`). √â uma tabela intermedi√°ria para compor os simulados com diferentes quest√µes.

| Campo         | Tipo     | Chave | Not Null | Descri√ß√£o               |
|---------------|----------|-------|----------|-------------------------|
| id            | bigint   | PK    | ‚úî        | Identificador √∫nico     |
| evaluation_id | bigint   | FK    | ‚úî        | Refer√™ncia ao simulado  |
| question_id   | bigint   | FK    | ‚úî        | Refer√™ncia √† quest√£o    |
| created_at    | datetime |       | ‚úî        | Data de cria√ß√£o         |
| updated_at    | datetime |       | ‚úî        | Data de atualiza√ß√£o     |

#### üîó Relacionamentos

- Uma `EvaluationQuestion` pertence a uma `Evaluation`.
- Uma `EvaluationQuestion` pertence a uma `Question`.
- Uma `EvaluationQuestion` pode ter v√°rias `UserAnswers`.




### üìå Entidade: `UserAnswer`

Armazena as respostas fornecidas pelos usu√°rios em cada simulado, podendo incluir alternativas selecionadas ou respostas escritas, dependendo do tipo de quest√£o.

| Campo                  | Tipo      | Chave | Not Null | Descri√ß√£o                                                        |
|------------------------|-----------|-------|----------|------------------------------------------------------------------|
| id                     | bigint    | PK    | ‚úî        | Identificador √∫nico                                              |
| evaluation_question_id | bigint    | FK    | ‚úî        | Refer√™ncia √† quest√£o dentro do simulado                         |
| user_id                | bigint    |  FK     | ‚úî        | Refer√™ncia ao usu√°rio que respondeu                     |
| question_type                   | smallint  |       | ‚úî        | Tipo da quest√£o (1=obj., 2=disc., 3=dissert.)                   |
| selected_option        | string    |       |          | Alternativa escolhida (para quest√µes objetivas)                 |
| written_answer         | text      |       |          | Resposta escrita pelo usu√°rio (para discursivas/dissertativas)  |
| created_at             | datetime  |       | ‚úî        | Data de cria√ß√£o                                                  |
| updated_at             | datetime  |       | ‚úî        | Data de atualiza√ß√£o                                              |

#### üîó Relacionamentos

- Uma `UserAnswer` pertence a uma `User`.
- Uma `UserAnswer` pertence a uma `EvaluationQuestion`.
- Uma `UserAnswer` √© associada a um `tipo` de quest√£o (definido por enum).
- Uma `UserAnswer` pode estar associada a uma `StandardAnswer` (quando discursiva/dissertativa).



### üìå Entidade: `StandardAnswer`

Armazena as respostas padr√£o (gabarito textual) associadas a uma quest√£o. √ötil para corre√ß√£o de quest√µes discursivas/dissertativas.

| Campo       | Tipo     | Chave | Not Null | Descri√ß√£o                                                  |
|-------------|----------|-------|----------|------------------------------------------------------------|
| id          | bigint   | PK    | ‚úî        | Identificador √∫nico                                        |
| question_id | bigint   | FK    | ‚úî        | Refer√™ncia √† quest√£o da tabela `questions`                 |
| text        | text     |       | ‚úî        | Conte√∫do da resposta padr√£o                                |
| is_active   | boolean  |       | ‚úî        | Indica se a resposta est√° ativa (para versionamento)  |
| created_at  | datetime |       | ‚úî        | Data de cria√ß√£o                                            |
| updated_at  | datetime |       | ‚úî        | Data de atualiza√ß√£o                                        |

#### üîó Relacionamentos

- Uma `StandardAnswer` pertence a uma `Question`.
- Uma `StandardAnswer` pode estar relacionada a v√°rias `UserAnswers`.


### üìå Entidade: `UserPerformance`

Registra estat√≠sticas consolidadas de desempenho de um aluno, por √°rea do direito, tipo de quest√£o e simulado.

#### üìã Dicion√°rio de Dados

| Campo            | Tipo       | Chave | Not Null | Descri√ß√£o                                                        |
|------------------|------------|-------|----------|------------------------------------------------------------------|
| id               | bigint     | PK    | ‚úî        | Identificador √∫nico                                              |
| user_id          | bigint     | FK    | ‚úî        | Refer√™ncia ao usu√°rio                                            |
| law_area_id      | bigint     | FK    | ‚úî        | Refer√™ncia √† √°rea do direito                                     |
| question_type    | smallint   |       | ‚úî        | Tipo da quest√£o (1 = objetiva, 2 = discursiva, 3 = dissertativa) |
| evaluation_id    | bigint     | FK    |          | Simulado relacionado (pode ser NULL para vis√£o consolidada)      |
| correct_count    | integer    |       | ‚úî        | Total de quest√µes respondidas corretamente                       |
| incorrect_count  | integer    |       | ‚úî        | Total de quest√µes respondidas incorretamente                     |
| total_questions  | integer    |       | ‚úî        | Total de quest√µes respondidas                                    |
| created_at       | datetime   |       | ‚úî        | Data de cria√ß√£o                                                  |
| updated_at       | datetime   |       | ‚úî        | Data de atualiza√ß√£o                                              |

#### üîó Relacionamentos

- Um `UserPerformance` pertence a um `User`.  
- Um `UserPerformance` pertence a uma `LawArea`.  
- Um `UserPerformance` pode estar relacionado a um `Evaluation` (simulado).
---





## ‚öñÔ∏è Regras de Neg√≥cio

- Cada quest√£o pode ter uma ou mais respostas padr√£o.
- Quest√µes objetivas devem ter uma alternativa correta indicada.
- Quest√µes discursivas devem ser comparadas com uma ou mais respostas padr√£o para feedback.

---
